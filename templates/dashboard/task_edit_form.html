<form method="post" enctype="multipart/form-data"
      action="/dashboard/tasks/edit/{{ task.id }}/">
    {% csrf_token %}

    <h5>Customer Information</h5>

    <div class="mb-2">
        <label>Name</label>
        <input name="cust_name" class="form-control" value="{{ task.cust_name }}">
    </div>

    <div class="mb-2">
        <label>Phone</label>
        <input name="cust_phone" class="form-control" value="{{ task.cust_phone }}">
    </div>

    <div class="mb-2">
        <label>WhatsApp</label>
        <input name="cust_whatsapp" class="form-control" value="{{ task.cust_whatsapp }}">
    </div>

    <div class="mb-2">
        <label>Location</label>
        <textarea name="cust_location" class="form-control">{{ task.cust_location }}</textarea>
    </div>

    <div class="mb-2">
        <label>Pincode</label>
        <input name="pincode" class="form-control" value="{{ task.pincode }}">
    </div>

    <hr>

    <h5>Task Details</h5>

    <div class="mb-2">
        <label>Category</label>
        <select name="category" class="form-control">
            <option value="">Select Category</option>
            {% for sc in subcategories %}
            <option value="{{ sc.id }}">{{ sc.name }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-2">
        <label>Additional Info</label>
        <textarea name="additional_info" class="form-control">{{ task.additional_info }}</textarea>
    </div>

    <div class="mb-2">
        <label>Task Image</label><br>
        {% if task.task_image %}
            <img src="{{ task.task_image.url }}" width="120"><br>
        {% endif %}
        <input type="file" name="task_image" class="form-control">
    </div>

    <hr>

    <h5>Worker Assignment</h5>

    <div class="mb-2">
        <label>Worker</label>
        <select name="worker" class="form-control">
            <option value="">Select Worker</option>
            {% for w in workers %}
            <option value="{{ w.id }}" {% if task.worker and task.worker.id == w.id %}selected{% endif %}>
                {{ w.name }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-2">
        <label>Worker Name (if manual entry)</label>
        <input name="worker_name" class="form-control" value="{{ task.worker_name }}">
    </div>

    <hr>

    <h5>Schedule</h5>

    <div class="mb-2">
        <label>Schedule Date</label>
        <input type="datetime-local" name="schedule_date"
               value="{{ task.schedule_date|date:'Y-m-d\\TH:i' }}"
               class="form-control">
    </div>

    <div class="mb-2">
        <label>Service Done Date</label>
        <input type="date" name="day_service_done"
               value="{{ task.day_service_done|date:'Y-m-d' }}"
               class="form-control">
    </div>

    <div class="mb-2">
        <label>Status</label>
        <select name="status" class="form-control">
            {% for key,label in task.STATUS_CHOICES %}
            <option value="{{ key }}" {% if task.status == key %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
    </div>

    <hr>

    <h5>Payment & Feedback</h5>

    <div class="mb-2">
        <label>Payment Received</label>
        <input name="payment_received_amt" type="number" step="0.01"
               class="form-control" value="{{ task.payment_received_amt }}">
    </div>

    <div class="mb-2">
        <label>Feedback</label>
        <textarea name="feedback" class="form-control">{{ task.feedback }}</textarea>
    </div>

    <div class="mb-2">
        <label>Rating</label>
        <input name="rating" type="number" step="0.1" min="0" max="5"
               class="form-control" value="{{ task.rating }}">
    </div>

    <button class="btn btn-primary mt-2 w-100">Save Changes</button>
</form>
