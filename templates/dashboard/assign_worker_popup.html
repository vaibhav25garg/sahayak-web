<div class="row mb-3">
    <div class="col-md-6">
        <input class="form-control" id="filter-name" placeholder="Search worker...">
    </div>

    <div class="col-md-4">
        <select class="form-control" id="filter-category">
            <option value="">All Categories</option>
            {% for c in categories %}
            <option value="{{ c.id }}">{{ c.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-2">
        <button id="filter-btn" class="btn btn-primary w-100">Filter</button>
    </div>
</div>

<table class="table table-hover table-bordered">
    <thead>
        <tr>
            <th>Name</th>
            <th>Phone</th>
            <th>Pincode</th>
            <th>Experience</th>
            <th>Categories</th>
            <th>Assign</th>
        </tr>
    </thead>

    <tbody>
    {% for w in workers %}
        <tr>
            <td>{{ w.name }}</td>
            <td>{{ w.phone }}</td>
            <td>{{ w.pincode }}</td>
            <td>{{ w.experience_years }} yrs</td>
            <td>{{ w.category.name }}</td>
            <td>
                <button class="btn btn-success btn-sm assign-worker"
                        data-id="{{ w.id }}"
                        data-name="{{ w.name }}">
                    Assign
                </button>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<script>
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('assign-worker')) {
        const wid = e.target.dataset.id;
        const name = e.target.dataset.name;

        console.log("Assign worker:", wid, name);

        const workerSelect = document.querySelector("select[name='worker']");
        const workerNameInput = document.querySelector("input[name='worker_name']");

        if (!workerSelect || !workerNameInput) {
            alert("Task form not found");
            return;
        }

        workerSelect.value = wid;
        workerNameInput.value = name;

        const modalEl = document.getElementById('assignWorkerModal');
        const modal = bootstrap.Modal.getInstance(modalEl);
        if (modal) modal.hide();
    }
});
</script>
